Section 7 ‚Äî Temporal Semantics: WAL & Replay

This is the chapter where we define:
- time
- ordering
- durability
- replay
- crash recovery
- how the universe reassembles itself
- how truth persists across reboots
- how subjective worlds continue after failure
- how deterministic the kernel must be
- how the causal graph is rehydrated
- how invariants are enforced after reboot
- how sync interacts with local time
- how partial events recover
- and literally the physics of time for JITOS

ADR-0007 was about RPC/ABI ‚Äî
but the architecture doc is following its own worldline:
	1.	Section 1: Kernel identity
	2.	Section 2: SWS
	3.	Section 3: RMG substrate
	4.	Section 4: Collapse physics
	5.	Section 5: MH projection layer
	6.	Section 6: Memory model
üëâ 7. Section 7: Temporal Semantics

Let‚Äôs begin.

---

JITOS Architecture Document ‚Äî Section 7

Temporal Semantics: WAL, Time, and Deterministic Replay

(Grounded in RFC-0006, ADR-0006, ADR-0001)

---

7. Temporal Semantics: WAL, Replay, and Time

7.1 Overview

In classical systems, ‚Äútime‚Äù is:
- a wall-clock timestamp
- a mutable metadata field
- local to the machine
- essentially decorative
- not tied to causality
- not secured
- not deterministic
- not meaningful to computation

In JITOS, time is:
- the ordering of events
- the replayable record of state transitions
- a cryptographic, causal, non-mutable structure
- the WAL (Write-Ahead Log)

The WAL is:
- the temporal backbone of JITOS
- the only mutable part of the kernel
- the log of ‚Äúbecoming‚Äù
- the structure that allows deterministic recovery
- the foundation for causal ordering
- the driver of state-machine consistency

In short:

The RMG is space;
the WAL is time.

‚ÄúTime‚Äù in JITOS is the existence of WAL entries
and their deterministic application into the RMG.

---

7.2 What the WAL Represents

The WAL is a sequence of temporal events describing:
- node creation
- ref updates
- index updates
- SWS lifecycle events
- provenance additions
- sync negotiations
- collapse metadata
- storage tier transitions (optional)
- MH projection invalidation markers
- capability negotiation

Each entry is immutable, hashed, and sequential.

The WAL does NOT represent:
- user keystrokes
- semantic deltas
- overlay graphs
- ephemeral memory

These are handled in SWS and collapse.

The WAL is the log of reality,
but not its internal structure.

---

7.3 WAL as Write-Ahead Guarantee

The WAL is written before any change is applied to:
- RMG
- indices
- MH projection
- refs
- caches

This ensures:
- atomicity
- durability
- crash safety
- replayability
- consistency across machines

A collapse event:
	1.	Writes WAL entries
	2.	fsyncs
	3.	Applies projection to local RMG
	4.	Updates indices
	5.	Updates refs
	6.	Updates MH
	7.	Clears ephemeral memory

If a crash happens at any step,
the WAL ensures that the system picks up cleanly.

---

7.4 WAL Entry Structure

Each WAL entry includes:
- magic header (‚ÄúJIT!‚Äù)
- version
- op_type
- logical timestamp
- payload length
- CBOR payload
- BLAKE3 checksum

This structure ensures:
- deterministic decoding
- cross-platform consistency
- safe partial entry detection
- forward compatibility
- canonical encoding

WAL entries correspond to time ticks in JITOS.

---

7.5 Logical Timestamps

JITOS does not use wall-clock timestamps
for ordering truth.

Time is advanced by:
	1.	Collapse events
	2.	Ref updates
	3.	Sync events
	4.	Node ingestion

Each WAL entry carries a Lamport clock:

ts = max(local_ts, incoming_ts) + 1

This gives JITOS:
- a total ordering of events
- deterministic replay across machines
- conflict-free representation of time
- safe multi-agent concurrency

Logical time is the only time JITOS trusts.

---

7.6 Replay Semantics

Replay occurs during:
- kernel boot
- crash recovery
- distributed sync
- universe federation
- forked processes reassembly
- RMG rehydration

Replay procedure:
	1.	Load last checkpoint (if it exists)
	2.	Read WAL sequentially
	3.	For each entry:
- validate checksum
- decode op
- apply deterministic effects to RMG
- update local indices
- track SWS state
	4.	Rebuild MH
	5.	Rebuild VTI
	6.	Rebuild semantic caches
	7.	Rerun or discard partial SWS

Replay is idempotent:
- same input WAL ‚Üí same output RMG
- across machines
- across time
- across architectures

This is how JITOS becomes a mathematically reproducible universe.

---

7.7 Crash Recovery Semantics

If the system crashes mid-collapse:
- WAL entries past last valid checksum are ignored
- indices are reconstructed deterministically
- MH is rebuilt from snapshot state
- partial SWS are discarded
- global truth remains intact
- no corruption can propagate

This property alone places JITOS above all existing:
- filesystems
- VCS
- CRDTs
- OS kernels
- DBs
- blockchains

The model is uncrashable with respect to truth.

---

7.8 WAL vs RMG Responsibilities

Layer	Role
WAL	time, ordering, transitions
RMG	truth, structure, semantics
SWS	speculation, local memory
MH	projection, usability

The WAL is the only mutable structure in the kernel.

The RMG is the only truth.

---

7.9 WAL Boundaries

The WAL:
- is append-only
- grows over time
- must be periodically checkpointed
- can be compacted safely
- must never be rewritten
- must never be truncated without a checkpoint

Checkpoint includes:
- VTI
- ref states
- index state
- semantic metadata
- universe identity

After checkpoint:
- WAL becomes shorter
- replay becomes faster
- RMG remains unchanged

This preserves the kernel‚Äôs temporal invariants.

---

7.10 Time & Multi-Agent Concurrency

Because:
- SWS are isolated
- collapse is atomic
- WAL assigns logical timestamps
- RMG is append-only

JITOS can safely support:
- thousands of agents
- independent shadow universes
- massively parallel reasoning
- concurrent semantic edits
- distributed cluster execution
- safe LLM autonomy
- deterministic multi-agent collaboration

There is no concept of:
- locks
- mutexes
- shared mutable memory
- race conditions
- double-write errors
- global contention

Time-based errors literally cannot occur.

---

7.11 Summary

JITOS defines time as:
- an immutable sequence of WAL entries
- forming the temporal spine of the universe
- replayable across machines
- reconstructable after failure
- correlated with RMG expansion
- driven by collapse, not clocks

WAL is the only mutable data structure.
RMG is the only truth.
Replay is the only recovery path.
Time = ordering of causal events.

This is the temporal physics of the causal operating system.
