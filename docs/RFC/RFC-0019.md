# JIT RFC-0019

Shadow Working Set Memory Model (SWS-MM v1.0)

Volatile State, Isolation, Collapse Semantics & Multilingual Agents

Status: Draft
Author: James Ross
Contributors: JIT Community
Requires:
	•	RFC-0003 SWS Semantics
	•	RFC-0004 Materialized Head
	•	RFC-0005 Inversion Engine
	•	RFC-0018 Causal Garbage Isolation**
Start Date: 2025-11-29
Target Spec: JITOS v0.x**
License: TBD**

⸻

1. Summary

This RFC defines the memory model for Shadow Working Sets (SWS):
	•	how volatile state is stored
	•	how overlays accumulate
	•	how memory isolation works
	•	how conflict regions behave
	•	how projections map into Shadows
	•	how caches operate
	•	how collapse flushes memory
	•	how failures restore memory
	•	how multiple agents interact with shared SWS
	•	how multilingual (natural-language + agent-language) semantics attach to memory

SWS is not just a “temp workspace.”

It is JIT’s process abstraction
AND
its cognitive space for humans and LLMs.

This RFC defines the formal laws of that space.

⸻

2. Motivation

SWS must behave like:
	•	a process
	•	a speculative future
	•	a scratchpad
	•	a timeline fork
	•	a self-consistent local universe
	•	a workspace for LLMs
	•	a deterministic memory zone
	•	an isolated ephemeral reality

The memory rules must be:
	•	deterministic
	•	isolated
	•	reversible
	•	replayable
	•	multilingual-friendly
	•	agent-safe
	•	collapse-compatible
	•	crash-safe

This RFC creates that foundation.

⸻

3. Memory Categories (SWS Memory = 4-layer model)

Every Shadow’s memory contains:

3.1 Virtual Tree Memory (VTM)

Projection of file tree into SWS:
	•	path → NodeID
	•	path → overlay chunk
	•	path → projected value

Equivalent to “virtual filesystem,” but semantic.

⸻

3.2 Overlay Graph Memory (OGM)

The actual structural memory of SWS:
	•	overlay nodes
	•	rewrite candidates
	•	conflict overlays
	•	patch accumulation
	•	agent-generated content

This is the “local reality” of SWS.

⸻

3.3 Semantic Memory (SM)

Provenance included here:
	•	agent reasoning
	•	LLM chain-of-thought (if stored)
	•	execution context
	•	metadata
	•	tags
	•	attributes
	•	language-specific semantics (“la palabra”, multi-lingual keys)

This is the cognitive memory of SWS.

⸻

3.4 Ephemeral Compute Memory (ECM)

Non-persistent state:
	•	tool caches
	•	lint states
	•	partial diffs
	•	build artifacts
	•	temporary views

This evaporates on collapse or discard.

⸻

4. Formal SWS Memory Invariants

Invariant 1 — Isolation

SWS memory MUST NOT impact global DAG until commit.

Invariant 2 — Purity

Overlays MUST NOT be applied to MH directly.

Invariant 3 — Deterministic Projection

Same DAG + same overlays MUST → identical VTM.

Invariant 4 — No Mutation of Past

SWS memory cannot alter ancestor nodes.

Invariant 5 — Purge on Collapse

Collapse MUST destroy ephemeral memory.

Invariant 6 — Safe Multilingual Semantics

Semantic memory keys MAY be multilingual
and MUST map to UTF-8 canonical CBOR fields.

So yes:
“la palabra, hermano”
and
“the word, brother”
and
“le mot, frère”
and
“言葉, 兄弟”
are equally valid semantic keys.

⸻

5. Memory Lifecycle

5.1 Creation

SWS loads:
	•	base snapshot projection (VTM)
	•	empty overlays (OGM)
	•	empty ephemeral caches (ECM)
	•	agent metadata (SM)

⸻

5.2 Mutation

Edits create:
	•	overlay chunk nodes (OGM)
	•	semantic data (SM)
	•	ephemeral analysis (ECM)

MH observers do not see these.

⸻

5.3 Conflict Memory

Conflict overlays are explicitly stored:

conflict: {
  ours: NodeID,
  theirs: NodeID,
  base: NodeID
}

Conflict regions are LOCAL until collapse.

⸻

5.4 Collapse Effects

On successful collapse:
	•	VTM → flushed
	•	OGM → rewritten into DAG
	•	SM → published as provenance
	•	ECM → destroyed

SWS memory is annihilated.

Only truth remains.

⸻

5.5 Discard

Same as collapse except:
	•	no rewriting
	•	no DAG updates
	•	ephemeral memory destroyed
	•	overlays dropped

Discard = quantum decoherence without measurement.

⸻

6. Memory Isolation Rules

6.1 No Write-Through

Writes to MH propagate into SWS memory only, not DAG.

6.2 No Leakage

OGM MUST NOT appear in MH.

6.3 Multi-Agent Concurrency

Multiple agents MAY write to same SWS only if:
	•	they are authorized (RFC-0017)
	•	MP synchronization resolves patch order
	•	collapse resolves conflicts

Agents writing in different languages
(English, Spanish, Japanese, LLM dialects)
MUST result in consistent SM encoding.

⸻

7. Multilingual Semantic Memory (MSM)

(You triggered this with “La Palabra, hermano.”)

Agents may attach semantic language keys:

SM["explanation.en"] 
SM["explanation.es"]
SM["explicación"]
SM["説明.jp"]

Rules:
	•	MUST canonicalize keys
	•	MUST store UTF-8
	•	MUST treat all languages equally
	•	MUST not affect collapse

JIT becomes language-agnostic truth,
with multilingual semantics layered on top.

Brutal. Beautiful. Necessary.

⸻

8. Failure & Crash Semantics

If SWS is partially active during crash:
	•	VTM reconstructed via DAG
	•	OGM restored via WAL
	•	SM restored from provenance nodes
	•	ECM destroyed
	•	if inconsistent → SWS invalidated
	•	user/agent notified

⸻

9. Why This Model Matters

This is the SWS equivalent of:
	•	Unix process memory
	•	VM stack + heap
	•	JS execution context
	•	WASM linear memory
	•	LLM short-term memory

BUT DONE RIGHT.

What makes it revolutionary:
	•	Causal safety
	•	Epistemic isolation
	•	Semantic layering
	•	Multilingual compatibility
	•	Deterministic collapse
	•	Non-destructive projection
	•	Agent-native memory primitives

This RFC defines the cognitive architecture
of the causal OS.

⸻

10. Status & Next Steps

Now with SWS-MM defined, we can:
	•	move to Security Model
	•	define Universe Federation
	•	define Multi-Agent Scheduling
	•	formalize Provenance Graph Semantics
	•	build the JITOS Kernel Architecture Doc

Next suggested RFCs:
	•	RFC-0020 — Security & Permissions Model
	•	RFC-0021 — Multi-Universe Federation Protocol (HUGE)
	•	RFC-0022 — Visualization & Rendering Protocol
	•	RFC-0023 — DAG Schema Evolution
	•	RFC-0024 — CΩMPUTER Fusion Layer

---

# **CΩMPUTER • JITOS** 
© 2025 James Ross • [Flying • Robots](https://flyingrobots.dev)
All Rights Reserved

