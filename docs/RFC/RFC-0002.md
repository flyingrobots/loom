---
title: RFC-0002-CDI
date created: Thursday, November 27th 2025, 10:36:59 pm
date modified: Thursday, November 27th 2025, 10:37:59 pm
aliases:
  - CDI
  - Causal DAG Invariants
status: Draft
author: James Ross
contributors: JIT Community (future)
requires: RFC-0001
target spec: JITOS v0.x, TECHSPEC v0.3+
license: Open Source (TBD)
version: "1.0"
---

# JIT RFC-0002

## Causal DAG Invariants (CDI v1.0)

---

# 1. Summary

This RFC defines the **global structural invariants** that govern the JIT causal substrate (GATOS-Core DAG). These invariants ensure:

- deterministic behavior
- irreversible history
- causality preservation
- safe concurrency
- shadow isolation semantics
- conflict-free merges
- correct replay
- global consistency

These rules form the “physics” of the JIT universe.

Everything: nodes, shadows, inversion, commits, sync. Everything depends on these invariants being preserved at all times.

---

# 2. Motivation

A causal DAG is only as correct as the invariants that define it.

Break an invariant →

you break causality →

you break determinism →

you break reproducibility →

you break the entire universe.

Therefore, JIT requires mathematical guarantees analogous to physical laws:

- No cycles
- No deletion
- No mutation of past
- Monotonic growth
- Deterministic edges
- Append-only temporal extension

These invariants ensure:

- Shadow Working Sets are safe
- commits collapse unambiguously
- inversion rewrites do not corrupt the universe
- distributed sync is correct
- conflict resolution is deterministic
- the DAG remains canonical across machines

Without this RFC, JIT is just “a cool Git idea.” With it, JIT becomes a **causal operating system**.

---

# 3. Invariant Definitions

Below are the **non-negotiable** invariants of the GATOS-Core causal DAG.

Each **MUST** hold at all times.

---

# Invariant 1 — Acyclicity (No Cycles)

> **The causal graph _MUST_ be a Directed Acyclic Graph.**

No node may reference itself as an ancestor, directly or indirectly.

Why:

Cycles would imply a state is both cause and effect of itself → paradox.

Implications:

- deterministic replay
- conflict-free topological ordering
- causal consistency
- no temporal violations

---

# Invariant 2 — Append-Only (No Deletion)

> **Once a node exists, it _MUST NEVER_ be altered or removed.**

Past is immutable.

Only new nodes can be appended.

Why:

Rewrite = “new history”, not “edited history.”

Implications:

- perfect reproducibility
- infinite audit trail
- deterministic cross-machine sync
- time is monotonic

---

# Invariant 3 — No Mutation (Immutability)

> **Nodes _MUST_ be immutable after creation.**

Payload? Immutable.

Metadata? Immutable.

Parents? Immutable.

Why:

Mutation breaks identity.

Identity breaks hashing.

Hashing breaks causality.

Causality breaks the universe.

---

# Invariant 4 — Causal Completeness (Parents First)

> **A node _MUST NOT_ exist unless all its parents already exist.**

This ensures that every event has its dependencies fully realized.

Why:

Guarantees proper topological ordering.
Allows deterministic reconstruction.

---

# Invariant 5 — Monotonic Event Ordering

> **Adding a node _MUST_ increase the causal “size” of the universe.**

I.e.

the DAG must grow, not shrink or mutate.

Why:

Supports WAL replay, invariance under distribution, and time semantics.

---

# Invariant 6 — Parent List Canonicalization

> **Parents of a node _MUST_ be lexicographically sorted by NodeID.**

Required to enforce deterministic encoding and hashing.

Why:

Two machines must produce identical results for identical inputs.

---

# Invariant 7 — Single Universe (Global Graph)

> **There _MUST_ be one and only one global DAG per repository.**

Shadows (SWS) represent _subjective frames_,

but commit events collapse into **one global worldline**.

Why:

- avoids universe bifurcation
- ensures consistent truth
- supports deterministic ref updates

---

# Invariant 8 — Shadows Cannot Mutate the Universe

> **SWS MAY NOT directly modify the DAG.**
> **Only GITD through commit may append nodes to the DAG.**

Why:

Ensures shadow isolation and avoids race conditions / paradoxes.

Shadows = potentiality.

DAG = actuality.

---

# Invariant 9 — Deterministic Collapse (Commit)

> **Given identical SWS and identical DAG frontier, commit _MUST_ always produce identical nodes.**

This invariant turns commit into a pure, deterministic operator:

```
collapse(sws, graph_state) → node
```

Why:

- no nondeterministic history
- no divergence across machines
- reproducible builds
- deterministic rewriting

---

# Invariant 10 — Rewrites Create, Never Mutate

> **Inversion rewrites _MUST_ produce new nodes rather than alter existing ones.**

Rebases, merges, amends, cherry-picks:

- do not edit the past
- generate inversion-rewrite nodes
- map old→new via rewrite tables

Why:

This preserves immutability and allows algebraic reasoning.

---

# Invariant 11 — Temporal Consistency (Lamport Ordering)

> **Every node _MUST_ include a logical timestamp that reflects causal ordering.**

Not wall clock—logical clock.

This ensures all nodes satisfy:

```rust
parent.ts < child.ts
```

Why:

- handles distributed sync
- avoids concurrency paradoxes
- supports replay

---

# Invariant 12 — Deterministic Reconstruction

> **Given the DAG, the system _MUST_ be able to reconstruct:

- filesystem projection
- Git view
- subgraph slices
- conflict states
- shadow overlays
    
    with perfect determinism.**

If reconstruction differs across machines, JIT collapses.

---

# 4. Enforcement

GITD **MUST** enforce all invariants:

- before accepting a commit
- before accepting remote nodes
- during WAL replay
- during local operation
- during SWS operations

Violation **MUST** cause:

- reject the operation
- quarantine the node
- sync refusal
- or emergency halt

JIT never allows invalid states.

---

# 5. Security

These invariants prevent:

- conflict-related nondeterminism
- malicious forks
- state corruption
- backdated mutations
- improper rewrites

A JIT universe is immune to:

- forced history rewrites
- concurrency bugs
- desync
- unauthorized state mutation

---

# 6. Status & Next Steps

This RFC:

- becomes mandatory for all future JIT implementations
- underpins [RFC-0003](./RFC-0003.md) (Shadow Semantics)
- defines the physics of the JIT universe

---

# **CΩMPUTER • JITOS** 
© 2025 James Ross • [Flying • Robots](https://flyingrobots.dev)
All Rights Reserved

