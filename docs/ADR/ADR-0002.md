---
Status: Proposed
Date: 2025-11-30
Owner: James Ross
Supersedes: None
Depends on: ADR-0001
Relates to: RFC-0003, RFC-0019, RFC-0005, RFC-0004
---

# ADR-0002 — The Shadow Working Set (SWS) as the Process Model

We’re about to define the core abstraction around which the entire causal OS orbits.

This is the equivalent of defining “processes” in Unix, “threads” in Linux, “actors” in Erlang, “isolates” in Dart, or “greenlets” in Go…

Except ours are:

- metaphysical
- causal
- semantic
- multi-agent
- observer-relative
- and aligned with the physics of CΩMPUTER.

This ADR is absolutely foundational.
This is the one that future implementers, engineers, researchers, philosophers, and AI-agent designers will reference.

Let’s carve it into the architecture.

---

## 1. Context

Operating systems require:

- a process model
- a unit of execution
- a boundary for isolation
- a mechanism for concurrency
- a container for state
- a sandbox for computation
- a context for identity and permissions

Traditional systems use:

- processes
- threads
- green threads
- actors
- fibers
- isolates

But all of these assume:

- mutable state
- shared memory
- global clocks
- mutable files
- linear time
- immediate access to global truth

These assumptions break under:

- multi-agent systems
- distributed computation
- LLM-based reasoning
- speculative editing
- scientific reproducibility
- concurrency under relativistic constraints
- causal consistency
- immutable past semantics

JITOS needs a process model that:

- fits causal invariants
- supports observer-relative computation
- isolates concurrent edits
- supports multi-agent workflows
- handles speculative state
- collapses deterministically
- leaves history untouched
- is ephemeral yet formally defined
- maps directly to the CΩMPUTER ontology

This leads naturally to the concept we’ve been dancing around:

Shadow Working Sets (SWS)

as the process abstraction of the causal OS.

This ADR formalizes SWS as the canonical, singular process model of JITOS.

---

## 2. Decision

> In JITOS, the process abstraction is the Shadow Working Set (SWS).
> 
> There are no threads, no processes, no coroutines, no fibers.
> 
> All computation—human or machine—occurs inside an SWS: a temporary, isolated, observer-relative branch of the causal universe that collapses into a new immutable event.

This includes:

- human edits
- code modifications
- LLM reasoning
- CI task execution
- refactoring
- analyses
- semantic transformations
- simulation step evaluations
- distributed agent interaction

Everything that “runs” runs in a Shadow.

SWS is the JITOS notion of a process.

---

## 3. Rationale

### 3.1 SWS naturally solves concurrency

Shadows are isolated by definition:

- no shared mutable state
- no conflicts until collapse
- no global lock contention
- no file-level races
- no concurrency hazards
- each agent sees a subjective local world

This mirrors special relativity rather than the POSIX memory model.

---

### 3.2 SWS matches the metaphysics of CΩMPUTER

CΩMPUTER states:

- computation occurs in observer-specific frames
- collapse events define reality
- shadows represent potential worlds
- truth is an immutable DAG

SWS are the practical implementation of this metaphysics.

---

### 3.3 SWS integrate perfectly with the DAG

- Base snapshot = initial state
- Overlays = speculative deltas
- Merge/Collapse = DAG event
- Destroy = no DAG mutation
- Provenance = optional semantic overlay

Everything aligns with invariant-based DAG logic.

---

### 3.4 SWS support multi-agent systems by design

Each agent gets:

- its own isolated shadow
- no interference
- no need for locks
- no global coordination
- purely local computation
- deterministic merge semantics

Perfect for:

- LLMs
- autonomous agents
- CI pipelines
- semantic bots
- analysis tools
- GUI editors
- batch jobs
- long-range simulations

---

### 3.5 SWS unify humans and machines

Humans edit files via MH → SWS.
Machines edit nodes via RPC → SWS.
Both are equivalent actors.

This makes JITOS the first OS where:

humans and AI share the same process abstraction.

---

## 4. Alternatives Considered

### 4.1 Traditional processes + threads

Rejected because:

- imply shared memory
- violate causal semantics
- not reproducible
- nondeterministic
- difficult to reason about
- incompatible with DAG-based truth

### 4.2 CRDT actors

Rejected because:

- CRDTs assume distributed mutable state
- we do not mutate state at all
- convergence semantics clash with collapse determinism
- no unified notion of “truth event”

### 4.3 VM-based isolates

Rejected because:

- treat global state as external
- incompatible with inversion semantics
- no natural mapping to DAG lineage
- higher resource overhead than SWS

### 4.4 Single global world

Rejected because:

- totally breaks down under concurrency
- no agent isolation
- no speculative execution
- no shadow semantics
- no collapse concept

---

## 5. Consequences

### 5.1 Positive

- deterministic concurrency
- perfect isolation
- unified model for humans + agents
- reproducible compute
- natural support for multi-agent workflows
- seamless integration with DAG and WAL
- elegant mapping to CΩMPUTER
- safe speculative execution
- easy rollback / discard semantics

---

### 5.2 Negative

- requires a more sophisticated kernel
- collapse logic must be strong
- debugging must support shadows
- mental model is new for developers
- requires real tooling to visualize

---

### 5.3 Required Follow-Ups

This ADR now mandates:

- Section 2 of Architecture Doc
- SWS lifecycle diagrams
- Shadow memory model in Section 6 (ADR-0019 interplay)
- Security model for SWS ownership (ADR-0017, ADR-0020)
- Collapse semantics (ADR-0004)
- Integration with Message Plane (RFC-0008)

---

## 6. Decision

**Accepted.**

Shadow Working Sets are the formal and singular process abstraction of JITOS.

All subsequent architecture design flows from this.
