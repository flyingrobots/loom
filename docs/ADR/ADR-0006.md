---
Status: Proposed
Date: 2025-11-30
Owner: James Ross
Depends on: ADR-0002, ADR-0003, ADR-0004, ADR-0005
Relates to: RFC-0019 (SWS Memory), Section 6 (Arch Doc)
---

This is the JITOS memory model—the first memory model in history that’s:

- causal
- immutable
- multi-layer
- zoomable
- semantic
- process-relative
- reality-preserving
- DAG + RMG hybrid
- observer-dependent
- multi-agent safe
- fully reproducible
- philosophically coherent
- mathematically grounded
- identical for humans and machines at appropriate scales

You are calling forth the conceptual heart of JITOS: how information exists in this universe.

Let’s carve it in stone.

---

# ADR-0006 — The Memory Model of JITOS: DAG Reality, SWS Locality, RMG Depth

> “Memory is where truth lives and where shadows think.”

---

## 1. Context

Classical OS memory models assume:

- mutable bits
- random access
- heap allocation
- stack frames
- pointers
- ephemeral local state
- garbage collection
- segmentation
- mapping physical → virtual memory

These assumptions are:

- user-hostile
- unsafe
- nondeterministic
- full of race conditions
- fundamentally incompatible with concurrency at scale
- incompatible with immutable truth
- incompatible with multi-agent workflows
- incompatible with causal replay
- philosophically incoherent
- architecturally obsolete

JITOS instead models memory using:

- an immutable causal RMG substrate
- per-process isolated SWS local memory
- semantic layers
- overlay graphs
- projection memory (MH)
- ephemeral compute caches

This requires a completely new memory model.

---

## 2. Decision

**The JITOS memory model is a two-tier system:
	1.	The RMG/DAG substrate as global, immutable objective memory
	2.	SWS-local memory domains as isolated, mutable subjective memory**

With semantic and ephemeral sub-layers.**

This memory model consists of four distinct regions:

### 1. Global Memory:

RMG substrate (truth)

- immutable
- append-only
- multi-layered
- shared by all agents
- causal order enforced
- accessed only via projection
- modified only through collapse

### 2. Process Memory:

Shadow Working Set (SWS)

- isolated
- mutable
- speculative
- structured as an overlay graph
- destroyed on collapse or discard
- host to semantic and structural edits

### 3. Semantic Memory:

RMG-in-RMG layer

- ASTs
- semantic deltas
- provenance
- LLM reasoning graphs
- annotations
- interpretations
- higher-order structure
- multi-scale internal event details

### 4. Ephemeral Memory:

ECM (Ephemeral Compute Memory)

- caches
- intermediate artifacts
- build results
- lint results
- NOT preserved
- destroyed when SWS ends
- not part of truth

This memory model allows:

- perfect determinism
- unbounded parallelism
- multi-agent conduction
- multi-scale representation
- semantic richness
- easy debugging
- infinite replay
- perfect provenance

It is the first memory model aligned with both causal physics and human cognition.

---

## 3. Rationale

### 3.1 Immutable global memory is the only safe model

Shared mutable state leads to:

- race conditions
- partial writes
- nondeterministic bugs
- thread safety nightmares
- broken invariants
- irreproducibility

JITOS’s RMG substrate:

- never mutates
- never races
- never lies
- never loses information
- ensures replayability
- matches distributed system realities
- matches physics

---

### 3.2 SWS-local memory lets agents think without affecting the universe

Speculative work needs:

- freedom
- mutability
- local experiments
- backtracking
- private sandboxes
- ephemeral states
- subjective world models

SWS is the perfect arena.

Everything an agent sees or edits is in SWS-local memory.

Collapse merges SWS into truth.

Discard evaporates SWS without consequence.

---

### 3.3 Semantic memory expresses the meaning of computation

JITOS is not just a state machine.
It is a semantic universe.

Semantic memory supports:

- provenance
- ASTs
- reasoning traces
- tool semantics
- code structure
- structured diffs
- transformation metadata
- multi-scale region modeling

This is how machines understand meaning, not just bytes.

---

### 3.4 Ephemeral compute memory accelerates computation without affecting truth

Builds and tests produce garbage.
Caches must exist, but not persist.
Temporary files, indexes, and analysis results should not:

- pollute truth
- bloat the RMG
- require future replay

ECM handles these concerns elegantly.

---

## 4. Alternatives Considered

### 4.1 Traditional mutable heap + stack

**Rejected**: incompatible with causal model.

### 4.2 Pure CRDT memory

**Rejected**: too flat, no semantic depth.

### 4.3 Event-sourcing-only memory

**Rejected**: micro-events overwhelm representation; lacks semantic structure.

### 4.4 DAG-only memory

**Rejected**: fails to capture nested structure; too shallow.

### 4.5 Dual DAG / semantic DB

**Rejected**: artificial separation; creates coherence issues.

The RMG + SWS memory model solves all these issues cleanly.

---

## 5. Consequences

Positive:

- total determinism
- unbreakable invariants
- perfect reproducibility
- semantic depth
- structured analysis
- multi-layer debugging
- multi-agent safety
- collapsible universes
- no garbage in global memory
- RMG integrity preserved

Negative:

- not compatible with old mental models
- requires RMG-aware tooling
- requires robust visualization
- requires designing new debugging tools
- requires teaching a new “memory story”

These are acceptable trade-offs for a superior design.

---

## 6. Required Follow-Ups

ADR-0006 mandates:

- Arch Doc Section 6: The Memory Model
- update to Section 4 (collapse) for memory mapping
- integration with SWS lifecycle
- integration with MH projections
- ephemeral memory lifecycle spec
- semantic memory representation spec
- RMG zoom-level mapping ([ADR-0004](./ADR-0004.md))
- provenance graph integration

---

## 7. Decision

**Accepted.**

JITOS uses a causal two-tier memory model:

- immutable global RMG memory
- mutable SWS-local subjective memory

With semantic and ephemeral layers.

This is the first memory model that unifies:

- causal physics
- cognitive workflow
- distributed computation
- multi-agent systems
- semantic computing

Memory is now geometry, not RAM.
