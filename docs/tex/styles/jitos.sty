\ProvidesPackage{styles/jitos}

\RequirePackage{silence}
\WarningFilter{latex}{Label `}               % suppress multiply-defined labels
\WarningFilter{latex}{Overfull \\hbox}       % suppress overfull hbox warnings
\WarningFilter{latex}{Underfull \\vbox}      % suppress underfull vbox warnings
\WarningFilter{latex}{There were multiply-defined labels}
\WarningFilter{rerunfilecheck}{File `}       % suppress rerunfilecheck warnings

% ========================================
% Package Imports
% ========================================

% Typography and fonts (Reverted to pdflatex compatible)
\usepackage[utf8]{inputenc}
\usepackage[T1]{fontenc}
\usepackage{lmodern}
\usepackage{microtype}

% Math and symbols
\usepackage{amsmath}
\usepackage{amssymb}
\usepackage{amsthm}

% Graphics and colors
\usepackage{graphicx}
\usepackage{xcolor}
\usepackage{styles/draculacolors}  % Dracula colors for code blocks (not full dark mode)
\usepackage{tikz}
\usetikzlibrary{shapes,arrows,positioning,calc,automata,decorations.pathreplacing,decorations.markings,shapes.geometric,fit,matrix,patterns,mindmap,trees,backgrounds,circuits.logic.US}

% SVG support (requires Inkscape installed)
\usepackage{svg}
\svgpath{{assets/images/}}

% Tables and Captions
\usepackage{longtable}
\usepackage{booktabs}
\usepackage{array}
\usepackage{calc}
\usepackage{caption}
\usepackage{etoolbox}

% Layout and spacing
\usepackage[
  a5paper,
  top=1in,
  bottom=1in,
  inner=0.75in,
  outer=0.75in
]{geometry}
\usepackage{setspace}
\usepackage{enumitem}

% Remove paragraph indentation and add spacing between paragraphs
\usepackage{parskip}
\setlength{\parindent}{0pt}
\setlength{\parskip}{0.5\baselineskip plus 2pt}

% Headers and footers
\usepackage{fancyhdr}
\setlength{\headheight}{26pt}

% Hyperlinks (load near end) - using Dracula colors
\usepackage[
  colorlinks=true,
  linkcolor=draculapurple,
  urlcolor=draculacyan,
  citecolor=draculagreen,
  bookmarks=true,
  bookmarksnumbered=true
]{hyperref}

% Code listings
\usepackage{listings}
\usepackage{verbatim}

% Quotations and blocks
\usepackage{csquotes}

% Title formatting
\usepackage{titlesec}
\usepackage{newunicodechar}

% ------------------------------------------------------------------
% Tame LaTeX warnings (over/underfull boxes, hyperref chatter)
% ------------------------------------------------------------------
\hbadness=10000
\hfuzz=2pt
\vfuzz=30pt
\emergencystretch=1em
% Silence hyperref warnings (e.g., bookmark depth/duplicate anchors)
\makeatletter
\def\Hy@Warning#1{}
\makeatother

% Map common Unicode symbols to LaTeX equivalents (handles generated content)
\newunicodechar{‚Ä¢}{\textbullet}
\newunicodechar{‚Üí}{\ensuremath{\rightarrow}}
\newunicodechar{‚Üê}{\ensuremath{\leftarrow}}
\newunicodechar{‚Üë}{\ensuremath{\uparrow}}
\newunicodechar{Œ©}{\ensuremath{\Omega}}
\newunicodechar{‚àò}{\ensuremath{\circ}}
\newunicodechar{Œî}{\ensuremath{\Delta}}
\newunicodechar{‚Äô}{'}
\newunicodechar{‚Äú}{``}
\newunicodechar{‚Äù}{''}
\newunicodechar{‚Ä¶}{\ldots}
\newunicodechar{‚ÇÄ}{\textsubscript{0}}
\newunicodechar{‚îå}{+}
\newunicodechar{‚îê}{+}
\newunicodechar{‚îò}{+}
\newunicodechar{‚î¨}{+}
\newunicodechar{‚î¥}{+}

% Relax box badness to avoid warnings
\hbadness=10000
\vbadness=10000
\hfuzz=60pt
\vfuzz=60pt
\newunicodechar{‚Äô}{'}
\newunicodechar{‚Äú}{``}
\newunicodechar{‚Äù}{''}
\newunicodechar{‚Ä¶}{\ldots}
\newunicodechar{‚ÇÄ}{\textsubscript{0}}
\newunicodechar{‚îå}{+}
\newunicodechar{‚îê}{+}
\newunicodechar{‚îò}{+}
\newunicodechar{‚î¨}{+}
\newunicodechar{‚î¥}{+}
\newunicodechar{Œ≤}{\ensuremath{\beta}}
\newunicodechar{‚â†}{\ensuremath{\neq}}
\newunicodechar{‚à™}{\ensuremath{\cup}}
\newunicodechar{‚à©}{\ensuremath{\cap}}
\newunicodechar{‚àÖ}{\ensuremath{\emptyset}}
\newunicodechar{‚äÜ}{\ensuremath{\subseteq}}
\newunicodechar{‚âà}{\ensuremath{\approx}}
\newunicodechar{‚àÇ}{\ensuremath{\partial}}
\newunicodechar{‚à∂}{:}
\newunicodechar{‚Äî}{\textemdash}
\newunicodechar{‚Ñ¢}{\textsuperscript{TM}}
\newunicodechar{‚úî}{\checkmark}
\newunicodechar{‚úó}{\texttimes}
\newunicodechar{‚óè}{\textbullet}
\newunicodechar{‚îÇ}{|}
\newunicodechar{‚îÄ}{-}
\newunicodechar{‚îú}{|-}
\newunicodechar{‚îî}{|-}
\newunicodechar{‚ï±}{/}
\newunicodechar{‚ï≤}{\textbackslash}
\newunicodechar{üì¶}{[pkg]}
\newunicodechar{üëâ}{\ensuremath{\rightarrow}}
\newunicodechar{‚ÇÅ}{\ensuremath{_{1}}}
\newunicodechar{‚ÇÇ}{\ensuremath{_{2}}}
\newunicodechar{‚àá}{\ensuremath{\nabla}}

% ========================================
% Custom Styling
% ========================================

% Define custom colors (using Dracula theme where appropriate)
\definecolor{quotegray}{RGB}{98, 114, 164}  % draculacomment
\definecolor{codebg}{RGB}{40, 42, 54}        % draculabg

% Custom theorem environments
\makeatletter
\theoremstyle{definition}
% Use section for article class, chapter for book class
\@ifundefined{chapter}{%
  \newtheorem{definition}{Definition}[section]
  \newtheorem{theorem}{Theorem}[section]
  \newtheorem{lemma}{Lemma}[section]
  \newtheorem{example}{Example}[section]
}{%
  \newtheorem{definition}{Definition}[chapter]
  \newtheorem{theorem}{Theorem}[chapter]
  \newtheorem{lemma}{Lemma}[chapter]
  \newtheorem{example}{Example}[chapter]
}
\makeatother

% Custom block quote style
\newenvironment{partintro}
  {\begin{quote}\itshape\color{quotegray}}
  {\end{quote}}

% Code listing style with Dracula theme
\lstset{
  basicstyle=\ttfamily\small\color{draculafg},
  backgroundcolor=\color{draculabg},
  frame=single,
  rulecolor=\color{draculacl},
  breaklines=true,
  columns=flexible,
  keepspaces=true,
  commentstyle=\color{draculacomment}\itshape,
  keywordstyle=\color{draculapink}\bfseries,
  stringstyle=\color{draculayellow},
  numberstyle=\tiny\color{draculacomment},
  identifierstyle=\color{draculacyan},
  showstringspaces=false
}

% Custom section styling for "FOR THE NERDS"
\newenvironment{nerdbox}
  {\par\vspace{0.5em}\noindent\hrulefill\newline\textbf{FOR THE NERDS‚Ñ¢}\newline\hrulefill\par\vspace{0.3em}\small}
  {\par\vspace{0.3em}\noindent\hrulefill\par\vspace{0.5em}}

% Pandoc compatibility macros
\providecommand{\tightlist}{
  \setlength{\itemsep}{0pt}\setlength{\parskip}{0pt}}
\newcommand{\passthrough}[1]{#1}

% Workaround for pandoc longtable "No counter 'none' defined" error
\newcounter{none}

% ========================================
% Macros
% ========================================

% Define Omega command for CŒ©MPUTER
\newcommand{\COmega}{C$\Omega$MPUTER}
\newcommand{\JITOS}{JITOS}

% Wordmark commands - use SVG logos (ASCII filename to avoid active-char issues)
\newcommand{\computerwordmark}[1][4cm]{\includesvg[width=#1]{COMPUTER.svg}}
\newcommand{\codexwordmark}[1][3cm]{\includesvg[width=#1]{CŒ©DEX.svg}}
\newcommand{\partwordmark}[2][5cm]{\includesvg[width=#1]{#2}}

% Custom chapter opening with optional wordmark
\newcommand{\chapterwithwordmark}[2]{
  \chapter{#1}
  \vspace{-1em}
  \begin{center}
  \includesvg[width=5cm]{#2}
  \end{center}
  \vspace{1em}
}

% Custom part page styling
\titleformat{\part}[display]
  {\centering\Huge\bfseries}
  {}
  {0pt}
  {\thispagestyle{empty}\vspace{3cm}}
  [\vspace{2cm}]

% ========================================
% Page Styling
% ========================================

\pagestyle{fancy}
\fancyhf{}
\setlength{\headwidth}{\textwidth}
\fancyhead[LE]{\parbox{\textwidth}{\raggedright\small\nouppercase{\leftmark}}}
\fancyhead[RO]{\parbox{\textwidth}{\raggedleft\small\nouppercase{\rightmark}}}
\fancyfoot[C]{\thepage}
\renewcommand{\headrulewidth}{0.4pt}
\renewcommand{\footrulewidth}{0pt}

% Chapter page style
\fancypagestyle{plain}{
  \fancyhf{}
  \fancyfoot[C]{\thepage}
  \renewcommand{\headrulewidth}{0pt}
}
